CREATE DATABASE FutbolStats;
USE FutbolStats;

CREATE TABLE PAIS(
	Codigo INT NOT NULL AUTO_INCREMENT,
	Nombre VARCHAR(50) NOT NULL,
	PRIMARY KEY(Codigo)
);

CREATE TABLE CIUDAD(
	Codigo INT NOT NULL,
	Nombre VARCHAR(50) NOT NULL,
	Pais INT NOT NULL,
	PRIMARY KEY(Pais,Codigo)
);

CREATE TABLE ESTADIO( 
	ID INT NOT NULL AUTO_INCREMENT,
	Nombre VARCHAR(32) NOT NULL,
	AnioInauguracion INT NOT NULL,
	Capacidad INT NOT NULL,
	Anchura INT NOT NULL,
	Longitud INT NOT NULL,
	Pais INT NOT NULL,
	Codigo INT NOT NULL,
	PRIMARY KEY(ID)
);

CREATE TABLE EQUIPO(
	Nombre VARCHAR(32) NOT NULL,
	AnioFundacion INT NOT NULL,
	PRIMARY KEY(Nombre)
);

CREATE TABLE POSEER(
	Estadio INT NOT NULL,
	Equipo VARCHAR(32) NOT NULL,
	PRIMARY KEY(Estadio,Equipo)
);

CREATE TABLE COMPETICION(
	ID INT NOT NULL AUTO_INCREMENT,
	Nombre VARCHAR(50) NOT NULL,
	AnioFundacion INT NOT NULL,
	URL VARCHAR (100) NOT NULL UNIQUE,
	Normativa TEXT NOT NULL,
	Pais INT NOT NULL,
	PRIMARY KEY (ID)
);

CREATE TABLE PARTIDO( 
	ID INT NOT NULL AUTO_INCREMENT,
	Jornada INT NOT NULL,
	Entrada BIGINT NOT NULL,
	Local VARCHAR(32) NOT NULL,
	Visitante VARCHAR(32) NOT NULL,
	Estadio INT NOT NULL,
	Competicion INT NOT NULL,
	Temporada INT NOT NULL,
	Fecha DATE NOT NULL,
	PRIMARY KEY (ID)
);

CREATE TABLE AGENCIA(
	CodigoFiscal VARCHAR(9) NOT NULL,
	Nombre VARCHAR(32) NOT NULL UNIQUE,
	Pais INT NOT NULL,
	PRIMARY KEY(CodigoFiscal)
	);

CREATE TABLE PROFESIONAL(
	Pasaporte CHAR(10) NOT NULL,
	Nombre VARCHAR(32) NOT NULL,
	Apellidos VARCHAR(64) NOT NULL,
	Nacionalidad VARCHAR(32) NOT NULL,
	Fecha_Nacimiento DATE NOT NULL,
	Fecha_Debut DATE NOT NULL,
	Pais INT NOT NULL,
	PRIMARY KEY (Pasaporte)
);

CREATE TABLE FUTBOLISTA(
	Pasaporte CHAR(10) NOT NULL,
	Posicion ENUM('P','LI','LD','DEF','MC','EI','ED','DC') NOT NULL,
	Valor BIGINT NOT NULL,
	Rendimiento_Seleccion FLOAT(4),
	Goles_Seleccion INT DEFAULT 0,
	Internacionalidades INT NOT NULL DEFAULT 0,
	PRIMARY KEY (Pasaporte)
);

CREATE TABLE ENTRENADOR(
	Pasaporte CHAR(10) NOT NULL,
	Seleccionador BOOLEAN NOT NULL DEFAULT false,
	Numero_Partidos_Seleccionador INT NOT NULL DEFAULT 0,
	PRIMARY KEY (Pasaporte)
);

CREATE TABLE REPRESENTAR_1(
	Futbolista CHAR(10) NOT NULL,
	Agencia CHAR(9) NOT NULL,
	Fecha_Ini DATE NOT NULL,
	Fecha_Fin DATE,
	PRIMARY KEY(Futbolista,Agencia,Fecha_Ini)
);

CREATE TABLE REPRESENTAR_2(
	Entrenador CHAR(10) NOT NULL,
	Agencia CHAR(9) NOT NULL,
	Fecha_Ini DATE NOT NULL,
	Fecha_Fin DATE,
	PRIMARY KEY(Entrenador,Agencia,Fecha_Ini)
);

CREATE TABLE ARBITRO (
	Pasaporte CHAR(10) NOT NULL,
        Institucion VARCHAR(32) NOT NULL,
        Partidos_selecciones INT NOT NULL DEFAULT 0,
        Profesion_aparte VARCHAR(32),
        PRIMARY KEY(Pasaporte)
);
        
CREATE TABLE FICHAJE_FUTBOLISTA(
	ID INT NOT NULL AUTO_INCREMENT,
        Cantidad_Economica FLOAT(2) NOT NULL,
        Sueldo FLOAT(2) NOT NULL,
        Fecha_Inicio DATE NOT NULL,
        Fecha_Fin DATE,
        Tipo ENUM('C', 'T') NOT NULL DEFAULT 'T',
        Equipo VARCHAR(32) NOT NULL,
        Futbolista CHAR(10) NOT NULL,  
        PRIMARY KEY(ID)
);
	
CREATE TABLE FICHAJE_ENTRENADOR(
	ID INT NOT NULL AUTO_INCREMENT,
        Cantidad_Economica FLOAT(2) NOT NULL,
        Sueldo FLOAT(2) NOT NULL,
        Fecha_Inicio DATE NOT NULL,
        Fecha_Fin DATE,
        Equipo VARCHAR(32) NOT NULL,
	Entrenador CHAR(10) NOT NULL,
        PRIMARY KEY(ID)
);
        
CREATE TABLE PARTICIPACION (
	Equipo VARCHAR(32) NOT NULL,
        Partido INT NOT NULL,
        Futbolista CHAR(10) NOT NULL,
	ID INT NOT NULL,
        Titular BOOLEAN NOT NULL DEFAULT true,
        PRIMARY KEY(Equipo,Partido,Futbolista,ID)      
);

CREATE TABLE CAMBIO(
	Equipo VARCHAR(32) NOT NULL,
        Partido INT NOT NULL,
        Futbolista CHAR(10) NOT NULL,
        ID INT NOT NULL,
	Minuto INT NOT NULL,
        Sale CHAR(10) NOT NULL,
        PRIMARY KEY(Equipo,Partido,Futbolista,ID)
);

CREATE TABLE INCIDENCIA(
	Equipo VARCHAR(32) NOT NULL,
        Partido INT NOT NULL,
        Futbolista CHAR(10) NOT NULL,
        ID INT NOT NULL,
        Minuto INT NOT NULL,
        PRIMARY KEY(Equipo,Partido,Futbolista,ID,Minuto)      
);

CREATE TABLE AMONESTACION(
	Equipo VARCHAR(32) NOT NULL,
	Partido INT NOT NULL,
	Futbolista CHAR(10) NOT NULL,
	ID INT NOT NULL,
	Minuto INT NOT NULL,
	Tipo ENUM('A','R') NOT NULL,
	PRIMARY KEY(Equipo,Partido,Futbolista,ID,Minuto)
);

CREATE TABLE GOL(
	Equipo VARCHAR(32) NOT NULL,
	Partido INT NOT NULL,
	Futbolista CHAR(10) NOT NULL,
	ID INT NOT NULL,
	Minuto INT NOT NULL,
	Forma ENUM('J','F','PY','PP') DEFAULT 'J',
	PRIMARY KEY(Equipo,Partido,Futbolista,ID,Minuto)
);

CREATE TABLE ARBITRAR(
	Arbitro CHAR(10) NOT NULL,
	Partido INT NOT NULL,
	Rol ENUM('AP','JL','4A','VAR') NOT NULL,
	
	PRIMARY KEY(Arbitro,Partido)
);

CREATE TABLE AFICIONADO(
	DNI CHAR(9) NOT NULL,
	Nombre VARCHAR(32) NOT NULL,
	Apellidos VARCHAR(64) NOT NULL,
	CorreoElectronico VARCHAR(64) NOT NULL,
	Edad INT NOT NULL,
	Equipo VARCHAR(32),
	PRIMARY KEY(DNI)
);

CREATE TABLE PERFIL_SOCIAL(
	Pasaporte CHAR(10) NOT NULL,
	IDRedSocial ENUM('I','T','Y') NOT NULL,
	Nick VARCHAR(64) NOT NULL,
	FechaAlta DATE NOT NULL,
	PRIMARY KEY(Pasaporte,IDRedSocial,Nick)
);

CREATE TABLE SEGUIR(
	Aficionado CHAR(9) NOT NULL,
	Pasaporte CHAR(10) NOT NULL,
	IDRedSocial ENUM('I','T','Y') NOT NULL,
	Nick VARCHAR(64) NOT NULL,
	PRIMARY KEY(Aficionado,Pasaporte,IDRedSocial,Nick)
);

CREATE TABLE ASISTIR(
	Aficionado CHAR(9) NOT NULL,
	Partido INT NOT NULL,
	PRIMARY KEY(Aficionado,Partido)
);

ALTER TABLE CIUDAD ADD FOREIGN KEY(Pais) REFERENCES PAIS(Codigo)
	ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE ESTADIO ADD FOREIGN KEY(Pais, Codigo) REFERENCES CIUDAD(Pais, Codigo)
	ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE POSEER ADD FOREIGN KEY(Estadio) REFERENCES ESTADIO(ID)
	ON UPDATE CASCADE ON DELETE CASCADE,
	ADD FOREIGN KEY(Equipo) REFERENCES EQUIPO(Nombre)
	ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE COMPETICION ADD FOREIGN KEY(Pais) REFERENCES PAIS(Codigo)
	ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE PARTIDO ADD FOREIGN KEY(Local) REFERENCES EQUIPO(Nombre)
	ON UPDATE CASCADE ON DELETE CASCADE,
	ADD FOREIGN KEY(Visitante) REFERENCES EQUIPO(Nombre)
	ON UPDATE CASCADE ON DELETE CASCADE,
	ADD FOREIGN KEY(Estadio) REFERENCES ESTADIO(ID)
	ON UPDATE CASCADE ON DELETE CASCADE,
	ADD FOREIGN KEY(Competicion) REFERENCES COMPETICION(ID)
	ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE AGENCIA ADD FOREIGN KEY (Pais) REFERENCES PAIS(Codigo)
	ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE PROFESIONAL ADD FOREIGN KEY (Pais) REFERENCES PAIS(Codigo)
	ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE FUTBOLISTA ADD FOREIGN KEY (Pasaporte) REFERENCES PROFESIONAL(Pasaporte)
	ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE ENTRENADOR ADD FOREIGN KEY (Pasaporte) REFERENCES PROFESIONAL(Pasaporte)
	ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE REPRESENTAR_1 ADD FOREIGN KEY (Futbolista) REFERENCES FUTBOLISTA(Pasaporte)
	ON UPDATE CASCADE ON DELETE CASCADE,
	ADD FOREIGN KEY (Agencia) REFERENCES AGENCIA(CodigoFiscal)
	ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE REPRESENTAR_2 ADD FOREIGN KEY (Entrenador) REFERENCES ENTRENADOR(Pasaporte)
	ON UPDATE CASCADE ON DELETE CASCADE,
	ADD FOREIGN KEY (Agencia) REFERENCES AGENCIA(CodigoFiscal)
	ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE ARBITRO ADD FOREIGN KEY(Pasaporte) REFERENCES PROFESIONAL(Pasaporte)
	ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE FICHAJE_FUTBOLISTA ADD FOREIGN KEY(Equipo) REFERENCES EQUIPO(Nombre)
	ON UPDATE CASCADE ON DELETE CASCADE,
	ADD FOREIGN KEY(Futbolista) REFERENCES FUTBOLISTA(Pasaporte)
	ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE FICHAJE_ENTRENADOR ADD FOREIGN KEY(Equipo) REFERENCES EQUIPO(Nombre)
	ON UPDATE CASCADE ON DELETE CASCADE,
	ADD FOREIGN KEY(Entrenador) REFERENCES ENTRENADOR(Pasaporte)
	ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE PARTICIPACION ADD FOREIGN KEY(Equipo) REFERENCES EQUIPO(Nombre)
	ON UPDATE CASCADE ON DELETE CASCADE,
	ADD FOREIGN KEY(Partido) REFERENCES PARTIDO(ID)
	ON UPDATE CASCADE ON DELETE CASCADE,
	ADD FOREIGN KEY(Futbolista) REFERENCES FUTBOLISTA(Pasaporte)
	ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE CAMBIO ADD FOREIGN KEY(Equipo,Partido,Futbolista,ID) REFERENCES PARTICIPACION(Equipo,Partido,Futbolista,ID)
	ON UPDATE CASCADE ON DELETE CASCADE,
	ADD FOREIGN KEY(Sale) REFERENCES FUTBOLISTA(Pasaporte)
	ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE INCIDENCIA ADD FOREIGN KEY(Equipo,Partido,Futbolista,ID) REFERENCES PARTICIPACION(Equipo,Partido,Futbolista,ID)
	ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE AMONESTACION ADD FOREIGN KEY(Equipo, Partido, Futbolista,ID,Minuto) REFERENCES INCIDENCIA (Equipo,Partido,Futbolista,ID,Minuto)
	ON UPDATE CASCADE ON DELETE CASCADE;


ALTER TABLE GOL ADD FOREIGN KEY(Equipo, Partido, Futbolista,ID,Minuto) REFERENCES INCIDENCIA (Equipo,Partido,Futbolista,ID,Minuto)
	ON UPDATE CASCADE ON DELETE CASCADE;


ALTER TABLE ARBITRAR ADD FOREIGN KEY(Arbitro) REFERENCES ARBITRO (Pasaporte)
	ON UPDATE CASCADE ON DELETE CASCADE,
	ADD FOREIGN KEY (Partido) REFERENCES PARTIDO (ID)
	ON UPDATE CASCADE ON DELETE CASCADE;


ALTER TABLE AFICIONADO ADD FOREIGN KEY(Equipo) REFERENCES EQUIPO (Nombre)
	ON UPDATE CASCADE ON DELETE CASCADE;


ALTER TABLE PERFIL_SOCIAL ADD FOREIGN KEY(Pasaporte) REFERENCES PROFESIONAL (Pasaporte)
	ON UPDATE CASCADE ON DELETE CASCADE;


ALTER TABLE SEGUIR ADD FOREIGN KEY(Aficionado) REFERENCES AFICIONADO (DNI)
	ON UPDATE CASCADE ON DELETE CASCADE,
	ADD FOREIGN KEY(Pasaporte, IDRedSocial, Nick) REFERENCES PERFIL_SOCIAL (Pasaporte, IDRedSocial, Nick)
	ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE ASISTIR ADD FOREIGN KEY(Aficionado) REFERENCES AFICIONADO (DNI)
	ON UPDATE CASCADE ON DELETE CASCADE,
	ADD FOREIGN KEY(Partido) REFERENCES PARTIDO(ID)
	ON UPDATE CASCADE ON DELETE CASCADE;